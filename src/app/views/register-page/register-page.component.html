<div class="p-fluid grid justify-content-center">
  <div class="col-10 sm:col-8 md:col-6 lg:col-4">
    <h3 class="col-12 text-center">Registrieren</h3>
    <form (ngSubmit)="submitRegister()"
          [formGroup]="form">
      <div class="field mb-4">
        <input
          pInputText
          formControlName="username"
          type="text"
          id="username" placeholder="Nutzername"
          aria-required="true"
          [attr.aria-invalid]="
          form.get('username')?.invalid && form.get('username')?.touched
        " >
        @if (form.get('username')?.invalid && form.get('username')?.touched) {
          @if (form.get('username')?.errors?.['required']) {
            <small class="text-red-500">Nutzername ist erforderlich.</small>
          }
          @if (form.get('username')?.errors?.['minlength']) {
            <small class="text-red-500">Dein Nutzername muss mindestens 3 Zeichen enthalten.</small>
          }
        }

      </div>

      <div class="field mb-4">
        <label for="email" class="sr-only">E-Mail</label>
        <input
          id="email"
          type="email"
          pInputText
          formControlName="email"
          class="w-full"
          placeholder="E-Mail"
          aria-required="true"
          [attr.aria-invalid]="
          form.get('email')?.invalid && form.get('email')?.touched
        " />
        @if (form.get('email')?.invalid && form.get('email')?.touched) {
          @if (form.get('email')?.errors?.['required']) {
            <small class="text-red-500">E-Mail ist erforderlich.</small>
          }
          @if (form.get('email')?.errors?.['email']) {
            <small class="text-red-500"
            >Bitte eine gültige E-Mail-Adresse eingeben.</small
            >
          }
        }
      </div>

      <div class="field mb-4">
        <label for="firstname" class="sr-only">E-Mail</label>
        <input
          id="firstname"
          type="text"
          pInputText
          formControlName="firstname"
          class="w-full"
          placeholder="Vorname"
          aria-required="true"
          [attr.aria-invalid]="
          form.get('firstname')?.invalid && form.get('firstname')?.touched
        " />
        @if (form.get('firstname')?.invalid && form.get('firstname')?.touched) {
          @if (form.get('firstname')?.errors?.['required']) {
            <small class="text-red-500">Vorname ist erforderlich.</small>
          }
          @if (form.get('firstname')?.errors?.['minlength']) {
            <small class="text-red-500">Vorname muss mindestens 3 Zeichen enthalten.</small>
          }
        }
      </div>

      <div class="field mb-4">
        <input
          pInputText
          formControlName="lastname"
          type="text"
          id="lastName"
          placeholder="Nachname"
          class="w-full"
          aria-required="true"
          [attr.aria-invalid]="form.get('lastname')?.invalid && form.get('lastname')?.touched">
        @if(form.get('lastname')?.invalid && form.get('lastname')?.touched){
          @if(form.get('lastname')?.errors?.['required']){
            <small class="text-red-500">Nachname ist erforderlich </small>
          }
        }
      </div>

      <div class="field mb-4">
        <p-calendar
          [iconDisplay]="'input'"
          [showIcon]="true"
          placeholder="Geburtsdatum"
          inputId="templatedisplay"
          class="w-full"
          formControlName="birthdate"
          aria-required="true"
          [attr.aria-invalid]="form.get('birthdate')?.invalid && form.get('birthdate')?.touched">
          <ng-template pTemplate="inputicon" let-clickCallBack="clickCallBack">
            <i class="pi pi-user pointer-events-none" (click)="clickCallBack($event)"></i>
          </ng-template>
        </p-calendar>
        @if(form.get('birthdate')?.invalid && form.get('birthdate')?.touched){
         @if(form.get('birthdate')?.errors?.['required']){
           <small>Geburtsdatum ist erforderlich </small>
         }
          @if (form.get('birthdate')?.errors?.['invalidDate']){
            <small>Das eingegebene Datum ist ungültig</small>
          }
          @if(form.get('birthdate')?.errors?.['minAge']){
            <small>Du musst mind. 16 Jahre alt sein!</small>
          }
        }
      </div>


      <div class="field mb-4">
        <p-dropdown
          id="gender"
          formControlName="gender"
          [options]="genderOptions"
          placeholder="Geschlecht"
          aria-required="true"
          [attr.aria-invalid]="form.get('gender')?.invalid && form.get('gender')?.touched"
        />
          @if(form.get('gender')?.errors?.['required']){
            <small class="text-red-500"> Geschlecht ist erforderlich</small>
          }
      </div>

      <div class="field mb-4">
        <p-iconField iconPosition="right">
          <p-inputIcon
            [styleClass]="passwordRegVisible ? 'ri-eye-off-line' : 'ri-eye-line'"
            (click)="togglePasswordVisibility('regPassword')"
            (keydown.enter)="togglePasswordVisibility('regPassword')"
            (keydown.space)="togglePasswordVisibility('regPassword')"
            tabindex="0"
            aria-label="Toggle password visibility"

          />

          <input
            [type]="passwordRegVisible ? 'text' : 'password'"
            pInputText
            formControlName="password"
            placeholder="Password"
            name="password"/>
        </p-iconField>
        @if (form.get('password')?.invalid && form.get('password')?.touched) {
          @if (form.get('password')?.errors?.['required']) {
            <small class="text-red-500">Passwort ist erforderlich.</small>
          }
          @if (form.get('password')?.errors?.['minlength']) {
            <small class="text-red-500"
            >Das Passwort muss mindestens 8 Zeichen lang sein.</small
            >
          }
        }
      </div>

      <div class="field mb-4">
        <p-iconField iconPosition="right">
          <p-inputIcon
            [styleClass]="passwordVisible ? 'ri-eye-off-line' : 'ri-eye-line'"
            (click)="togglePasswordVisibility('proofPassword')"
            (keydown.enter)="togglePasswordVisibility('proofPassword')"
            (keydown.space)="togglePasswordVisibility('proofPassword')"
            tabindex="0"
            aria-label="Toggle password visibility"/>

          <input
            [type]="passwordVisible ? 'text' : 'password'"
            pInputText
            formControlName="confirmPassword"
            id="confirmPassword"
            placeholder="Password"
            name="proofPassword"
            aria-required="true"
            [attr.aria-invalid]="form.get('password')?.invalid && form.get('password')?.touched"
          />
        </p-iconField>
        @if (form.get('confirmPassword')?.invalid && form.get('confirmPassword')?.touched) {
          @if (form.get('confirmPassword')?.errors?.['required']) {
            <small class="text-red-500">Passwort muss wiederholt werden!</small>
          }
          @if (form.errors?.['passwordMissmatch']) {
            <small class="text-red-500"
            >Die Passwörter stimmen nicht überein!</small
            >
          }
        }

      </div>

      <div class="field ">
        <p-button [raised]="true" label="Registrieren" severity="secondary"/>
      </div>
    </form>
  </div>
  <p>Du hast bereits einen Account?
    <a routerLink="/welcome" class="">Hier einloggen!</a>
  </p>
</div>

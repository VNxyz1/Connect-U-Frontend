<div class="p-fluid grid justify-content-center mb-8">
  <div class="col-10 sm:col-8 md:col-6 lg:col-4">
    <h3 class="col-12 text-center">Registrieren</h3>
    <p-toast [breakpoints]="{ '920px': { width: '90%', top: '30' } }" />
    <form (ngSubmit)="submitRegister()"
          [formGroup]="form">
      <div class="field mb-4">
        <input
          pInputText
          formControlName="username"
          type="text"
          id="username" placeholder="Nutzername*"
          aria-required="true"
          [attr.aria-invalid]="
          form.get('username')?.invalid && form.get('username')?.touched
        " >
        @if (form.get('username')?.invalid && form.get('username')?.touched) {
          @if (form.get('username')?.errors?.['required']) {
            <small class="text-red-500">Nutzername ist erforderlich.</small>
          }
          @if (form.get('username')?.errors?.['minlength']) {
            <small class="text-red-500">Dein Nutzername muss mindestens 3 Zeichen enthalten.</small>
          }
        }

      </div>

      <div class="field mb-4">
        <label for="email" class="sr-only">E-Mail</label>
        <input
          id="email"
          type="email"
          pInputText
          formControlName="email"
          class="w-full"
          placeholder="E-Mail*"
          aria-required="true"
          [attr.aria-invalid]="
          form.get('email')?.invalid && form.get('email')?.touched
        " />
        @if (form.get('email')?.invalid && form.get('email')?.touched) {
          @if (form.get('email')?.errors?.['required']) {
            <small class="text-red-500">E-Mail ist erforderlich.</small>
          }
          @if (form.get('email')?.errors?.['email']) {
            <small class="text-red-500"
            >Bitte eine gültige E-Mail-Adresse eingeben.</small
            >
          }
        }
      </div>

      <div class="field mb-4">
        <label for="firstName" class="sr-only">Firstname</label>
        <input
          id="firstName"
          type="text"
          pInputText
          formControlName="firstName"
          class="w-full"
          placeholder="Vorname*"
          aria-required="true"
          [attr.aria-invalid]="
          form.get('firstName')?.invalid && form.get('firstName')?.touched
        " />
        @if (form.get('firstName')?.invalid && form.get('firstName')?.touched) {
          @if (form.get('firstName')?.errors?.['required']) {
            <small class="text-red-500">Vorname ist erforderlich.</small>
          }
          @if (form.get('firstName')?.errors?.['minlength']) {
            <small class="text-red-500">Vorname muss mindestens 3 Zeichen enthalten.</small>
          }
        }
      </div>

      <div class="field mb-4">
        <input
          pInputText
          formControlName="lastName"
          type="text"
          id="lastName"
          placeholder="Nachname*"
          class="w-full"
          aria-required="true"
          [attr.aria-invalid]="form.get('lastName')?.invalid && form.get('lastName')?.touched">
        @if(form.get('lastName')?.invalid && form.get('lastName')?.touched){
          @if(form.get('lastName')?.errors?.['required']){
            <small class="text-red-500">Nachname ist erforderlich </small>
          }
        }
      </div>

      <div class="field mb-4">
        <p-calendar
          [iconDisplay]="'input'"
          [showIcon]="true"
          placeholder="Geburtsdatum*"
          inputId="templatedisplay"
          class="w-full"
          formControlName="birthday"
          aria-required="true"
          dateFormat="yy-mm-dd"
          [attr.aria-invalid]="form.get('birthday')?.invalid && form.get('birthday')?.touched">
          <ng-template pTemplate="inputicon" let-clickCallBack="clickCallBack">
            <i class="pi pi-user pointer-events-none" (click)="clickCallBack($event)"></i>
          </ng-template>
        </p-calendar>
        @if(form.get('birthday')?.invalid && form.get('birthday')?.touched){
         @if(form.get('birthday')?.errors?.['required']){
           <small>Geburtsdatum ist erforderlich </small>
         }
          @if (form.get('birthday')?.errors?.['invalidDay']){
            <small>Das eingegebene Datum ist ungültig</small>
          }
          @if(form.get('birthday')?.errors?.['minAge']){
            <small>Du musst mind. 16 Jahre alt sein!</small>
          }
        }
      </div>


      <div class="field mb-4">
        <p-dropdown
          id="gender"
          formControlName="gender"
          [options]="genderOptions"
          placeholder="Geschlecht*"
          aria-required="true"
          [attr.aria-invalid]="form.get('gender')?.invalid && form.get('gender')?.touched"
        />
          @if(form.get('gender')?.errors?.['required']){
            <small class="text-red-500"> Geschlecht ist erforderlich</small>
          }
      </div>

      <div class="field mb-4">
        <p-iconField iconPosition="right">
          <p-inputIcon
            [styleClass]="passwordRegVisible ? 'ri-eye-off-line' : 'ri-eye-line'"
            (click)="togglePasswordVisibility('regPassword')"
            (keydown.enter)="togglePasswordVisibility('regPassword')"
            (keydown.space)="togglePasswordVisibility('regPassword')"
            tabindex="0"
            aria-label="Toggle password visibility"

          />

          <input
            [type]="passwordRegVisible ? 'text' : 'password'"
            pInputText
            formControlName="password"
            placeholder="Passwort*"
            name="password"/>
        </p-iconField>
        @if (form.get('password')?.invalid && form.get('password')?.touched) {
          @if (form.get('password')?.errors?.['required']) {
            <small class="text-red-500">Passwort ist erforderlich.</small>
          }
          @if (form.get('password')?.errors?.['minlength']) {
            <small class="text-red-500"
            >Das Passwort muss mindestens 8 Zeichen lang sein.</small
            >
          }
        }
      </div>

      <div class="field mb-4">
        <p-iconField iconPosition="right">
          <p-inputIcon
            [styleClass]="passwordVisible ? 'ri-eye-off-line' : 'ri-eye-line'"
            (click)="togglePasswordVisibility('proofPassword')"
            (keydown.enter)="togglePasswordVisibility('proofPassword')"
            (keydown.space)="togglePasswordVisibility('proofPassword')"
            tabindex="0"
            aria-label="Toggle password visibility"/>

          <input
            [type]="passwordVisible ? 'text' : 'password'"
            pInputText
            formControlName="confirmPassword"
            id="confirmPassword"
            placeholder="Passwort wiederholen*"
            name="proofPassword"
            aria-required="true"
            [attr.aria-invalid]="form.get('password')?.invalid && form.get('password')?.touched"
          />
        </p-iconField>
        @if (form.get('confirmPassword')?.invalid && form.get('confirmPassword')?.touched) {
          @if (form.get('confirmPassword')?.errors?.['required']) {
            <small class="text-red-500">Passwort muss wiederholt werden!</small>
          }
          @if (form.errors?.['passwordMissmatch']) {
            <small class="text-red-500"
            >Die Passwörter stimmen nicht überein!</small
            >
          }
        }

      </div>
      <div class="field mb-4">
        <div>
          Bitte bestätigen Sie die
          <a [routerLink]="['/agb']" class="text-primary no-underline">AGBs</a>
          <p-checkbox
            formControlName="agb"
            class="ml-3"
            [binary]="true"
            variant="filled"
            inputId="agbCheckbox">
          </p-checkbox>
        </div>
      </div>

      <div class="field ">
        <p-button [raised]="true"
                  type="submit"
                  label="Registrieren"
                  severity="secondary"/>
      </div>
    </form>
    <p class="text-center">Du hast bereits einen Account?
      <a [routerLink]="['/welcome']" class="text-primary no-underline">Hier einloggen!</a>
    </p>
  </div>

</div>

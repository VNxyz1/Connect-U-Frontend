<p-dialog
  [(visible)]="notLoggedInDialogVisible"
  contentStyleClass="border-round"
  [showHeader]="false"
  [draggable]="false"
  [focusOnShow]="false"
  modal
  [closeOnEscape]="false"
  [closable]="false"
  [style]="{ width: '25rem' }">
  <div class="py-4">
    @if (loginRegisterSwitch) {
      <app-login
        [redirectTo]="'/event/' + eventId"
        (toggleView)="toggleLoginRegisterSwitch()"
        class="w-full" />
    } @else {
      <app-register (toggleView)="toggleLoginRegisterSwitch()" class="w-full" />
    }
  </div>
</p-dialog>

@if (isLoading) {
  <div class="flex justify-content-center align-items-center mt-8">
    <p-progressSpinner
      styleClass="w-4rem h-4rem"
      strokeWidth="8"
      fill="var(--surface-ground)"
      animationDuration=".5s">
    </p-progressSpinner>
  </div>
} @else {
  <div class="xl:mr-8 p-0 m-0 mb-8 grid justify-content-center">
    <div class="col-12 xl:col-7">
      <div class="flex justify-content-center p-0 sm:p-0 m-0">
        <p-image
          [alt]="'landingPage.headerImageAlt' | transloco"
          src="./images/pexels-elevate-1267254.jpg"
          class="w-full"
          styleClass="w-full"
          imageClass="w-full" />
      </div>
    </div>
    <div class="col-12 xl:col-7">
      <h2>{{ eventDetails.title }}</h2>

      <div class="flex w-full justify-content-between">
        <span>
          <app-event-status-indicator
            [status]="eventDetails.status"
            showText
            invertedColor />
        </span>
        <span>
          @for (category of eventDetails.categories; track $index) {
            <p-tag [value]="category.name" [rounded]="true" class="mr-1" />
          }
        </span>
      </div>

      <p-card styleClass="p-mb-3 mt-3">
        <div class="grid">
          <div class="col">
            <div class="flex items-center">
              <rmx-icon name="calendar-line" class="mr-2"></rmx-icon>
              <p class="m-0">
                {{
                  eventDetails.dateAndTime
                    | translocoDate: { dateStyle: 'medium' }
                }}
              </p>
            </div>
            <div class="flex items-center mt-3">
              <rmx-icon name="time-line" class="mr-2"></rmx-icon>
              <p class="m-0">
                {{
                  eventDetails.dateAndTime
                    | translocoDate: { timeStyle: 'short' }
                }}
              </p>
            </div>
          </div>
          <div class="col">
            <div class="flex items-center">
              <rmx-icon name="map-pin-2-line" class="mr-2"></rmx-icon>
              @if (eventDetails.street || eventDetails.streetNumber) {
                <p class="m-0">
                  {{ eventDetails.street }} {{ eventDetails.streetNumber }}
                </p>
              }
              @if (!eventDetails.city) {
                <p class="m-0">Online-Event</p>
              }
            </div>
            @if (eventDetails.city) {
              <p class="m-0 ml-5">
                {{ eventDetails.zipCode }} {{ eventDetails.city }}
              </p>
            }
          </div>
        </div>
        <h3>{{ 'eventDetailPageComponent.eventDetails' | transloco }}</h3>
        <p>{{ eventDetails.description }}</p>
        <div>
          <p-tag
            severity="secondary"
            value="Secondary"
            [rounded]="true"
            class="mr-1" />
          <p-tag
            severity="secondary"
            value="Secondary"
            [rounded]="true"
            class="mr-1" />
          <p-tag
            severity="secondary"
            value="Secondary"
            [rounded]="true"
            class="mr-1" />
        </div>
      </p-card>

      <div class="">
        @if (
          eventDetails && eventRequestsHost.length > 0 && eventDetails.isHost
        ) {
          <p-card
            class="p-3 cursor-pointer"
            [routerLink]="['requests']"
            [relativeTo]="route">
            <div class="flex flex-column justify-content-between h-full">
              <!-- Top Section: Header and Count -->
              <div class="flex justify-content-between align-items-center mb-2">
                <!-- Header Section (Left Top) -->
                <h3 class="mt-0 mb-0">
                  {{ 'eventDetailPageComponent.requests' | transloco }}
                </h3>
                <!-- Request Count (Right Top, Aligned with Header) -->
                <span class="color-secondary text-center w-2rem">{{
                  this.eventRequestsHost.length
                }}</span>
              </div>

              <!-- Bottom Section -->
              <div class="flex justify-content-between align-items-center">
                <!-- Profile Pictures (Left Bottom) -->
                <div class="flex">
                  @for (r of this.eventRequestsHost; track r) {
                    @if (r.user.imageUrl) {
                      <img
                        [src]="'/path/to/profile/pictures/' + r.user.imageUrl"
                        alt="{{ r.user.username }}"
                        class="profile-picture"
                        style="
                          width: 3em;
                          height: 3em;
                          border-radius: 50%;
                          margin-right: -5px;
                          border: 2px solid white;
                        " />
                    } @else {
                      <img
                        src="https://via.placeholder.com/100"
                        alt="{{ r.user.username }}"
                        class="profile-picture"
                        style="
                          width: 3em;
                          height: 3em;
                          border-radius: 50%;
                          margin-right: -5px;
                          border: 2px solid white;
                        " />
                    }
                  }
                </div>
                <!-- Icon (Bottom Right) -->
                <div class="flex align-items-right">
                  <rmx-icon
                    name="arrow-right-s-line"
                    style="height: 26px; width: 26px"
                    class="ml-2">
                  </rmx-icon>
                </div>
              </div>
            </div>
          </p-card>
        }
      </div>

      @if (
        eventDetails.startAge ||
        eventDetails.endAge ||
        eventDetails.preferredGenders.length > 0
      ) {
        <div class="mt-3">
          <p-card styleClass="mb-3">
            <h3>{{ 'eventDetailPageComponent.restrictions' | transloco }}</h3>
            <div class="grid">
              <div class="col">
                @if (eventDetails.preferredGenders.length > 0) {
                  <p class="pb-3 color-secondary">
                    {{ 'eventDetailPageComponent.gender' | transloco }}
                  </p>
                }
                @if (eventDetails.startAge || eventDetails.endAge) {
                  <p class="color-secondary">
                    {{ 'eventDetailPageComponent.age' | transloco }}
                  </p>
                }
              </div>
              <div class="col">
                @if (eventDetails.preferredGenders.length > 0) {
                  <p class="pb-3">
                    {{
                      getPreferredGendersString(eventDetails.preferredGenders)
                    }}
                  </p>
                }
                <p>
                  {{
                    eventDetails.startAge
                      ? ('eventDetailPageComponent.from' | transloco) +
                        ' ' +
                        eventDetails.startAge +
                        ' ' +
                        ('eventDetailPageComponent.years1' | transloco)
                      : ''
                  }}
                </p>
                <p>
                  {{
                    eventDetails.endAge
                      ? ('eventDetailPageComponent.to' | transloco) +
                        ' ' +
                        eventDetails.endAge +
                        ' ' +
                        ('eventDetailPageComponent.years2' | transloco)
                      : ''
                  }}
                </p>
              </div>
            </div>
          </p-card>
        </div>
      }
    </div>
    <div class="mt-3 col-12 lg:col-fixed lg:w-max">
      <div class="flex gap-1 justify-content-end md:flex-none xl:fixed">
        <p-button class="" [raised]="true" severity="info">
          <ng-template pTemplate="icon">
            <rmx-icon
              style="width: 16px; height: 16px"
              name="heart-3-line"></rmx-icon>
          </ng-template>
        </p-button>
        @if (
          eventDetails && (eventDetails.isHost || eventDetails.isParticipant)
        ) {
          <!-- TODO Event absagen / Teilnahme lÃ¶schen-->
        } @else if (userRequest) {
          <p-button
            [raised]="true"
            (onClick)="deleteEventRequest(userRequest.id, $event)">
            <ng-template pTemplate="icon">
              <rmx-icon
                style="width: 16px; height: 16px"
                name="close-line"></rmx-icon>
            </ng-template>
          </p-button>
          <p-button
            [raised]="true"
            [label]="
              userRequest.denied
                ? ('myEventPageComponent.requests.try-again' | transloco)
                : ('eventDetailPageComponent.request-pending' | transloco)
            "
            severity="success"
            [disabled]="!userRequest.denied"
            (click)="handleButtonClick(eventDetails.type)">
            @if (!userRequest.denied) {
              <ng-template pTemplate="icon">
                <rmx-icon
                  style="width: 16px; height: 16px"
                  name="hourglass-fill"></rmx-icon>
              </ng-template>
            }
          </p-button>
        } @else {
          <p-button
            [raised]="true"
            [label]="
              eventDetails.type === 1 && !eventDetails.isParticipant
                ? ('eventDetailPageComponent.join' | transloco)
                : eventDetails.type === 2
                  ? ('eventDetailPageComponent.request' | transloco)
                  : eventDetails.type === 3
                    ? ('eventDetailPageComponent.privateEvent' | transloco)
                    : ''
            "
            [disabled]="eventDetails.type === 3"
            severity="success"
            (click)="handleButtonClick(eventDetails.type)">
          </p-button>
        }
      </div>
    </div>
    <div class="xl:col-5"></div>
  </div>
}
